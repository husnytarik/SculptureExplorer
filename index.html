<!DOCTYPE html>
<html lang="tr">

<head>
    <link rel="icon" href="data:,">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Sculpture Explorer — MVP</title>

    <!-- Styles -->
    <link rel="stylesheet" href="./css/styles.css" />

    <!-- three.js import map -->
    <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js",
      "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/"
    }
  }
  </script>
</head>

<body>
    <noscript>Bu uygulama için JavaScript gerekli.</noscript>

    <div class="app">
        <!-- ===== VIEWER ===== -->
        <div class="viewer" id="viewer">
            <div class="overlay">
                <span class="pill" id="hudMode">Model Görüntüleme ve Ölçüm</span>
            </div>

            <!-- Sağ dikey araç çubuğu -->
            <div class="toolrail" id="measureRail">
                <button class="toolbtn" data-mode="distance" aria-label="Mesafe">
                    <span class="toolbtn__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <circle cx="6" cy="18" r="2" fill="currentColor" />
                            <circle cx="18" cy="6" r="2" fill="currentColor" />
                            <line x1="8.5" y1="15.5" x2="15.5" y2="8.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </span>
                    <span class="toolbtn__label">Mesafe</span>
                </button>

                <button class="toolbtn" data-mode="polyline" aria-label="Yol Uzunluğu">
                    <span class="toolbtn__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <polyline points="4,16 10,10 16,14 20,8" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <circle cx="4" cy="16" r="2" fill="currentColor" />
                            <circle cx="10" cy="10" r="2" fill="currentColor" />
                            <circle cx="16" cy="14" r="2" fill="currentColor" />
                            <circle cx="20" cy="8" r="2" fill="currentColor" />
                        </svg>
                    </span>
                    <span class="toolbtn__label">Yol Uzunluğu</span>
                </button>

                <button class="toolbtn" data-mode="surface2" aria-label="Yüzey Mesafesi">
                    <span class="toolbtn__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <circle cx="5" cy="17" r="2" fill="currentColor" />
                            <circle cx="19" cy="7" r="2" fill="currentColor" />
                            <path d="M7 15 C 10 6, 14 20, 17 9" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </span>
                    <span class="toolbtn__label">Yüzey Mesafesi</span>
                </button>

                <button class="toolbtn" data-mode="surfacePath" aria-label="Yüzey Yol">
                    <span class="toolbtn__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M4 16 C 8 8, 12 18, 16 10 S 20 7, 20 8" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" fill="none" />
                            <circle cx="4" cy="16" r="2" fill="currentColor" />
                            <circle cx="10" cy="13" r="1.8" fill="currentColor" />
                            <circle cx="15" cy="11" r="1.8" fill="currentColor" />
                            <circle cx="20" cy="8" r="2" fill="currentColor" />
                        </svg>
                    </span>
                    <span class="toolbtn__label">Yüzey Yol</span>
                </button>

                <button class="toolbtn" data-mode="girth" aria-label="Kesit Çevresi">
                    <span class="toolbtn__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-dasharray="3 2" fill="none" />
                            <circle cx="12" cy="12" r="2" fill="currentColor" />
                        </svg>
                    </span>
                    <span class="toolbtn__label">Kesit Çevresi</span>
                </button>
            </div>

            <!-- Sağ üst aksiyonlar -->
            <div class="viewer-actions">
                <!-- Işık & Görünüm toggle (ghost toolbtn) -->
                <button class="toolbtn" id="btnViewPanel" aria-label="Işık & Görünüm">
                    <span class="toolbtn__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2" />
                            <line x1="12" y1="2" x2="12" y2="5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <line x1="12" y1="19" x2="12" y2="22" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <line x1="2" y1="12" x2="5" y2="12" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <line x1="19" y1="12" x2="22" y2="12" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <line x1="4.2" y1="4.2" x2="6.3" y2="6.3" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <line x1="17.7" y1="17.7" x2="19.8" y2="19.8" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <line x1="4.2" y1="19.8" x2="6.3" y2="17.7" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <line x1="17.7" y1="6.3" x2="19.8" y2="4.2" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </span>
                    <span class="toolbtn__label">Işık & Görünüm</span>
                </button>
            </div>

            <div class="view-panel" id="viewPanel" hidden>
                <div class="row gap8">
                    <button class="chip" id="btnPerspective" title="Perspective">Persp</button>
                    <button class="chip" id="btnOrtho" title="Orthographic">Ortho</button>
                    <label class="mini">FOV
                        <input id="fovSlider" type="range" min="20" max="120" value="45">
                    </label>
                </div>

                <div class="row gap8">
                    <label class="mini">Azimut
                        <input id="azimuth" type="range" min="0" max="360" value="45">
                    </label>
                    <label class="mini">Yükseklik
                        <input id="elevation" type="range" min="0" max="89" value="35">
                    </label>
                </div>

                <div class="row gap8">
                    <label class="mini">Parlaklık
                        <input id="intensity" type="range" min="0" max="1000" value="120">
                    </label>
                    <label class="mini">Arka Plan
                        <input id="bgColor" type="color" value="#000000">
                    </label>
                </div>

                <div class="row gap8 wrap">
                    <label class="check mini">
                        <input id="gridToggle" type="checkbox" checked><span>Grid</span>
                    </label>
                    <label class="check mini">
                        <input id="dirOff" type="checkbox"><span>Directional kapalı</span>
                    </label>
                    <label class="check mini">
                        <input id="grayscale" type="checkbox"><span>S/B</span>
                    </label>
                </div>
            </div>

            <!-- Ölçüm değerleri: viewer üzerinde -->
            <div class="measure-readout measure-readout--overlay" id="measureReadoutOverlay">
                <span class="muted">Ölçüm</span>
            </div>
        </div>

        <!-- ===== SIDEBAR ===== -->
        <div class="sidebar">
            <div class="sidepanel">
                <div class="sidepanel__body">
                    <!-- Model -->
                    <div class="card">
                        <h3>Model</h3>
                        <div class="col">
                            <input class="input" id="modelUrl" placeholder=".glb / .gltf URL" value="./models/sc.glb" />
                            <div class="grid">
                                <button class="btn" id="loadBtn">URL'den Yükle</button>
                                <button class="btn" id="screenshotBtn">PNG Kaydet</button>
                            </div>

                            <!-- ▼ İSTENEN: Görünüm panelini aç/kapat butonu -->
                            <div class="grid">
                                <button class="btn" id="toggleViewPanel">Işık & Görünüm Paneli</button>
                            </div>

                            <div class="stats">
                                <div class="stat">
                                    <span class="stat__label">Üçgen</span>
                                    <span class="stat__value" id="triCount">-</span>
                                </div>
                                <div class="stat">
                                    <span class="stat__label">Boyut</span>
                                    <span class="stat__value" id="bboxInfo">-</span>
                                </div>
                                <div class="stat">
                                    <span class="stat__label">Ölçek</span>
                                    <span class="stat__value" id="scaleInfo">1.000</span>
                                    <span class="stat__unit">m/birim</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ölçek & Birimler -->
                    <div class="card">
                        <h3>Ölçek & Birimler</h3>
                        <div class="col">
                            <div class="grid">
                                <select id="unitSelect" class="select">
                                    <option value="m">Metre (m)</option>
                                    <option value="cm">Santimetre (cm)</option>
                                    <option value="mm">Milimetre (mm)</option>
                                    <option value="ft">Feet (ft)</option>
                                    <option value="in">İnç (in)</option>
                                    <option value="custom">Özel (m/birim)</option>
                                </select>
                                <input class="input" id="metersPerUnit" type="number" step="any" value="1"
                                    placeholder="m/birim" />
                            </div>
                            <div class="grid">
                                <input class="input" id="calReal" type="number" step="any"
                                    placeholder="Gerçek uzunluk (metre)" />
                                <button class="btn" id="btnCalFromLast">Son ölçümle kalibre et</button>
                            </div>
                            <span class="muted" style="font-size:12px">İpucu: Önce iki nokta ölçün, sonra gerçek
                                uzunluğu (m) girip kalibre edin.</span>
                        </div>
                    </div>

                    <!-- Katalog -->
                    <div class="card">
                        <h3>Koleksiyon (catalog.json)</h3>
                        <div class="col">
                            <div class="grid">
                                <button class="btn" id="loadCatalog">Sunucudan Yükle</button>
                                <button class="btn" id="applyMeta">Seçileni Uygula</button>
                            </div>
                            <div class="grid">
                                <input type="file" id="catalogFile" accept=".json" class="input" />
                                <button class="btn" id="loadCatalogFile">Dosyadan Katalog</button>
                            </div>
                            <select id="catalogSelect" class="select">
                                <option value="">— Kayıt seç —</option>
                            </select>
                            <div id="catalogPreview" class="muted" style="font-size:12px"></div>
                        </div>
                    </div>

                    <!-- ÖLÇÜM ARAÇLARI KARTI KALDIRILDI -->
                    <!-- ▼ Ama main.js 'must' ile bazı id'leri bekliyor.
               Bu nedenle görünmeyen (hidden) minimal DOM'u tutuyoruz. -->
                    <div class="hide" aria-hidden="true">
                        <select id="measureMode">
                            <option value="none">—</option>
                            <option value="distance">distance</option>
                            <option value="polyline">polyline</option>
                            <option value="surface2">surface2</option>
                            <option value="surfacePath">surfacePath</option>
                            <option value="girth">girth</option>
                        </select>
                        <button id="clearMarks" type="button">clear</button>
                        <button id="exportCSV" type="button">csv</button>
                    </div>

                    <!-- Filtreler -->
                    <div class="card">
                        <h3>Filtreler</h3>
                        <div class="col">
                            <div class="grid">
                                <!-- RTI / Raking Light -->
                                <div class="fx-group">
                                    <label><input type="checkbox" id="fxRaking"> Raking Light (RTI)</label>
                                    <div style="margin-left:1em;">
                                        <label>Gain <input id="rGain" type="range" min="0.5" max="3" step="0.1"
                                                value="1.2"></label>
                                        <label>Wrap <input id="rWrap" type="range" min="0" max="0.6" step="0.05"
                                                value="0.3"></label>
                                    </div>
                                </div>
                                <label class="row" style="gap:8px;"><input type="checkbox" id="fxSsao"> SSAO (ortam
                                    gölgeleme)</label>
                                <div class="grid">
                                    <label class="row" style="gap:8px;"><input type="checkbox" id="fxCurv"> Curvature
                                        (Cavity)</label>
                                    <label>Güç <input type="range" id="fxCurvAmt" class="slider" min="0.01" max="200"
                                            value="80"></label>
                                </div>
                                <label class="row" style="gap:8px;"><input type="checkbox" id="fxEdges"> Kenar Vurgusu
                                    (Sobel)</label>
                            </div>
                            <div class="grid">
                                <select id="fxQuality" class="select">
                                    <option value="low">Kalite: Düşük (mobil)</option>
                                    <option value="high" selected>Kalite: Yüksek</option>
                                </select>
                                <button class="btn" id="btnRaking">Raking Işık (preset)</button>
                                <button class="btn" id="btnFxReset">Filtreleri Sıfırla</button>
                            </div>
                            <span class="muted" style="font-size:12px">Mobilde performans için kaliteyi “Düşük”
                                seçin.</span>
                        </div>
                    </div>

                    <!-- Meta -->
                    <div class="card">
                        <h3>Bilgi & Etiketler</h3>
                        <div class="col">
                            <input class="input" id="title" placeholder="Eser adı" />
                            <div class="grid">
                                <input class="input" id="category" placeholder="Kategori (ör. Heykel)" />
                                <input class="input" id="type" placeholder="Tür (ör. büst, figür)" />
                            </div>
                            <div class="grid">
                                <input class="input" id="period" placeholder="Dönem (ör. Roma)" />
                                <input class="input" id="material" placeholder="Malzeme (ör. Mermer)" />
                            </div>
                            <div class="grid">
                                <input class="input" id="culture" placeholder="Kültür/Okul" />
                                <input class="input" id="geo" placeholder="Konum (ülke/şehir/alan)" />
                            </div>
                            <textarea class="input" id="abstract" rows="3"
                                placeholder="Bilimsel özet / açıklama"></textarea>
                            <textarea class="input" id="publications" rows="2"
                                placeholder="Yayınlar (satır başına DOI/URL)"></textarea>
                            <button class="btn" id="saveMeta">Bu modele metayı ata</button>
                        </div>
                    </div>

                    <!-- Arama -->
                    <div class="card">
                        <h3>Arama / Benzer Bul</h3>
                        <div class="col">
                            <input class="input" id="q" placeholder="Ara: kategori, dönem, malzeme, kültür, konum…" />
                            <div class="grid">
                                <button class="btn" id="btnSearch">Ara</button>
                                <button class="btn" id="btnSimilar">Bu modele benzer</button>
                            </div>
                            <div class="list" id="results"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- /.sidebar -->
    </div><!-- /.app -->

    <!-- Mobil için panel aç/kapat -->
    <button class="fab" id="toggleSidebar" aria-label="Panel">☰</button>

    <!-- View panel toggle wiring -->
    <script>
        (function () {
            const fab = document.getElementById('viewFab');
            const panel = document.getElementById('viewPanel');
            const btn = document.getElementById('toggleViewPanel');

            function togglePanel() { if (panel) panel.hidden = !panel.hidden; }

            if (fab && panel) fab.addEventListener('click', togglePanel);
            if (btn && panel) btn.addEventListener('click', togglePanel);
        })();
    </script>

    <!-- Entry modules -->
    <script type="module" src="./js/rtiRaking.js"></script>
    <script type="module" src="./js/filters.js"></script>
    <script type="module" src="./js/main.js"></script>
</body>

</html>